class Create<%= Diffit.function_name.to_s.camelize %>TriggersOn<%= @model.name.pluralize %> < ActiveRecord::Migration
  def up

    execute <<-SQL
      CREATE TRIGGER <%= Diffit.function_name %>_on_<%= @model.table_name %>_insert_trigger
      AFTER INSERT ON <%= @model.table_name %>
      FOR EACH ROW
      EXECUTE PROCEDURE <%= Diffit.function_name %>('<%= @model.name %>');
    SQL

    execute <<-SQL
      CREATE TRIGGER <%= Diffit.function_name %>_on_<%= @model.table_name %>_update_trigger
      AFTER UPDATE ON <%= @model.table_name %>
      FOR EACH ROW
      WHEN (OLD.* IS DISTINCT FROM NEW.*)
      EXECUTE PROCEDURE <%= Diffit.function_name %>('<%= @model.name %>');
    SQL

  end

  def down

    execute <<-SQL
      DROP TRIGGER <%= Diffit.function_name %>_on_<%= @model.table_name %>_insert_trigger ON <%= @model.table_name %>;
    SQL

    execute <<-SQL
      DROP TRIGGER <%= Diffit.function_name %>_on_<%= @model.table_name %>_update_trigger ON <%= @model.table_name %>;
    SQL

  end
end
